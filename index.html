<!DOCTYPE html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Algorithmic Documentation</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,400;0,700;1,100;1,300;1,400&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="documentation_assets/css/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism-tomorrow.min.css" integrity="sha512-vswe+cgvic/XBoF1OcM/TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous">
</head>
<body>
  <div class="layout">
    <div class="table-of-contents">
      <div class="darkMode">DarkMode</div>
      <ul class="lay1">
        <li><a href="#top">Intro</a></li>
        <li><a class="expand" href="#">File Structure Overview<i class="fas fa-chevron-down"></i></a>
          <ul class="lay2 toggleView">
            <li> <a href="#root-level">Root Level</a></li>
            <li> <a href="#batch-design">/batch_design</a></li>
            <li> <a href="#config-folder">/config</a></li>
            <li> <a href="#doc-assets">/documentation_assets</a></li>
            <li> <a href="#local-funcs">/local_functions</a></li>
            <li> <a href="#mkt-csvs">/mkt_csvs</a></li>
            <li> <a href="#results">/results</a></li>
            <li> <a href="#temp-assets">/temp_assets</a></li>
          </ul>
        </li>
        <li><a class="expand" href="#">Getting Up and Running<i class="fas fa-chevron-down"></i></a>
          <ul class="lay2 toggleView">
            <li><a class="expand" href="#">Batch Testing <i class="fas fa-chevron-down"></i></a>
              <ul class="lay3 toggleView">
                <li><a href="#standard-batch">Standard Batch</a></li>
                <li><a href="#batch-params">Batch Customization</a></li>
              </ul>
            </li>
            <li><a class="expand" href="#"> Single Stock Testing <i class="fas fa-chevron-down"></i></a>
              <ul class="lay3 toggleView">
                <li><a href="#batch-of-one">Batch of One</a></li>
                <li><a href="#without-batch">Without Batching</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a class="expand" href="#">Viewing Results<i class="fas fa-chevron-down"></i></a>
          <ul class="lay2 toggleView">
            <li> <a href="#">Batch Results</a></li>
            <li> <a href="#">Individual Day Results</a></li>
            <li> <a href="#">Comparing Batches</a></li>
          </ul>
        </li>
        <li><a href="#">Creating A Strategy</a></li>
        <li><a href="#">Debug Mode</a></li>
        <li><a href="#">Configuration Files</a></li>
      </ul>
    </div>
    <div class="main">
      <div class="top-head" id="top">
        <h1>Algorithmic Trading Backtester</h1>
        <h2>Documentation and Explanation of An Algorithmic Backtester</h2>
      </div>
      <section>
        <h2 id="intro">Intro</h2>
        <p>
          This is a Algorithmic trading backtester for lightning quick trading sometimes referred to as 
          "<em>Day Trading</em>" or (more specifically) "<em>Scalping</em>". 
          
          <br>
          <br>
          This brand of investing involves very short 
          trade periods, sometimes minutes, sometimes seconds. This is a huge departure from more typical investing which 
          has a time-horizon of several months to many years. In short term trading, the stocks traded are 
          riskier and are experiencing a period of abnormal volatility. 
          
          <br><br>
          The basic precept behind daytrading ideology is that 
          there is inefficency in extremely volatile stocks. The time period that has volatility is evidence of this inefficiency
          and allows a short window to capitalize on the higher percentage swings.
          
          <br><br>
          This project works with CSV files with the open, high, low and close prices (OHLC) for each minute during normal 
          market hours (9:30AM - 4PM EST). I have created an algorithm that will create what is known as <em>tick</em> data 
          for each one of these minutes. The source code for interpolating second data is in the <span class="path">local_functions/data_management/historical_funcs.py</span> 
          in the function called "<em>create_second_data</em>"
        </p>
      </section>
      <section id="file-struct">
        <h2>File Structure Overview</h2>
        <div class="folder"> 
          <h3 id="root-level">Root Level</h3>
          <p>Files in the home directory</p>
          <div class="file">
            <p><span class="path">index.html</span>: This page!</p>
          </div>
          <div class="file">
            <p><span class="path">main.py</span>: from here batch testing can be commenced as well as batch 
              comparisons and various other functions. While batch testing 
              does have command line interface, I often edit this file for more exact control.
            </p>
          </div>
          <div class="file">
            <p><span class="path">test.py</span>: A file for sandbox testing of functionality of new features. 
              Nothing pivotal happens here.
            </p>
          </div>
          <div class="file">
            <p><span class="path">update_form.py</span>: When run will update the <span class="path">config_form.html</span> based on the new values
              in the <span class="path">local_functions/main/config.json</span> and the adjacent <span class="path">config_descriptions.json</span>. 
              If you would like more info on this process, you can visit the documentation I did for this form generation 
              <a href="https://dcorso21.github.io/PythonFormsFromJSON/" target="_blank">here</a>.
            </p>
          </div>
          <div class="file">
            <p><span class="path">batches.html</span>: This file is updated with each batch test and serves as a directory for 
              all of the previous results of the batches. Here is the <a href="batches.html" target="_blank">current batches.html</a>.
            </p>
          </div>
        </div>
        <div class="folder"> 
          <h3 id="batch-design">/batch_design</h3>
          <p>This directory holds the templates and the assets (CSS, JS, Fonts) for the 
            <div id="results-files">results pages</div> 
            These assets are both used when visiting the results pages, and also used for creating them.
          </p>
        </div>
        <div class="folder">
          <h3 id="config-folder">/config</h3>
          <p>
            This folder stores all of the saved configurations for batch tests and also the templates for creating 
            new forms to create the configurations. I know that this seems odd. If you are interested in seeing how this 
            is done, please check out my documentation of the process 
            <a href="https://dcorso21.github.io/PythonFormsFromJSON/" target="_blank">here</a>.
          </p>
        </div>
        <div class="folder"> 
          <h3 id="doc-assets">/documentation_assets</h3>
          <p>The documentation is what you are reading right now. Inside this folder is the assets seen in these docs.</p>
        </div>
        <div class="folder">
          <h3 id="local-funcs">/local_functions</h3>
          <p>
            Local Functions is where all of the code for trading is located. Inside this folder are multiple folders which divide 
            the work of trading the stock. All of these python files are meant to be accessed through the <span class="path">main.py</span> file as modules.
          </p>
          <div class="folder"> 
            <h4>/account</h4>
            <p>This folder is for account info. At present it only keeps track of starting capital.</p>
          </div>
          <div class="folder">
            <h4>/analyse</h4>
            <p>
              There are three processes going on continuously as a stock is being considered during trading hours: Data Gathering, Data Analysis, and Trade Execution. 
              This folder deals with the second process: Data Analysis
            </p>
            <div class="file">
              <p><span class="path">analyse.py</span>: The master file outlining the process of analysis. It calls for other files in the folder. 
                Most notably, <span class="path">order_eval.py</span> and <span class="path">update_docs.py</span>.
              </p>
            </div>
            <div class="file">
              <p><span class="path">common.py</span>: a set of functions that analyse data that are common to many tasks across the algorithm's structure. 
                This of this as a common library of useful functions.
              </p>
            </div>
            <div class="file">
              <p><span class="path">order_eval.py</span>: Functions for evaluating if an order should take place</p>
            </div>
            <div class="file">
              <p><span class="path">order_tools.py</span>: Functions for creating Order Specifications such as how much to buy sell in shares or cash at which second, and at which price.
                There is a lot that can be customized in orders, such as the ability to daisy-chain buys or sells, or to programmatically cancel orders after a specific
                amount of time of if the price is out of reach.
              </p>
            </div>
            <div class="file">
              <p><span class="path">strategies.py</span>: Coming Soon. At the moment, strategies are hosted in the <span class="file">order_eval.py</span> file.</p>
            </div>
            <div class="file">
              <p><span class="path">update_docs.py</span>: This file takes the new data found and analyses it to give the algorithm a sense of momentum. These "docs" 
                that are updating are dataframes and dictionaries with information about momentum, volume and volatility (among others) to project when to buy and sell. 
                The docs are hosted as global variables imported from the <span class="path">local_functions/main/global_vars.py</span> file.
              </p>
            </div>
          </div>
          <div class="folder">
            <h4>/data_management</h4>
            <p>Data Management is where the second data is generated, the csvs are pulled and so much more.</p>
            <div class="file">
              <p><span class="path">gather_data.py</span>: This file is dedicated to tasks run every (simulated) second to inform the algorithm on
                how the stocks technical chart has changed in the last second. From here global dataframe and dictionary variables are updated 
                to carry the most up-to-date information.
              </p>
            </div>
            <div class="file">
              <p><span class="path">historical_funcs.py</span>: These functions pull the data from the csvs, interpolate them into second data, 
                convert them into a dataframe and simulate the data movement you might see in a live open market. So whereas the 
                <span class="path">gather_data.py</span> file is about the algorithm updating itself to the simulated data, this file is about 
                creating that simulated data, which is then doled out, second by second, to the algorithm.
              </p>
            </div>
            <div class="file">
              <p><span class="path">stock_screening.py</span>: These are functions not currently incorporated into the system. The idea is to 
                web-scrape with selenium and beautiful soup in order to see which stocks are currently volatile.
              </p>
            </div>
          </div>
          <div class="folder">
            <h4>/main</h4>
            <p>
              The folder which holds files with configuration, batch testing, and global variables as well as other miscellaneous things
              like logging.
            </p>
            <div class="file">
              <p><span class="path">algo.py</span>: The file that holds the bare frame of the algorithm. If you wish to see how the algorithm functions, start here.</p>
            </div>
            <div class="file">
              <p><span class="path">batch_testing.py</span>: The file dedicated to performing batch tests and making comparisons of batches.</p>
            </div>
            <div class="file">
              <p><span class="path">config.json</span>: The settings for configuring how the algorithm performs and how executions are simulated.</p>
            </div>
            <div class="file">
              <p><span class="path">config_descriptions.json</span>: Descriptions for the <span class="path">config.json</span> file. for more info, view the documentation for 
                this system <a href="https://dcorso21.github.io/PythonFormsFromJSON/" target="_blank">here</a>.
              </p>
            </div>
            <div class="file">
              <p><span class="path">configure.py</span>: Functions for loading the <span class="path">config.json</span> settings into the algorithm at start of testing and ensuring 
                that the simulation follows those guidelines.
              </p>
            </div>
            <div class="file">
              <p><span class="path">global_variables.py</span>: Home to many functions and variables that are shared across documents.</p>
            </div>
            <div class="file">
              <p><span class="path">log_funcs.py</span>: I employed a very different log that kept track of things like line number and file name during this process in a 
                global variable dataframe. The log is actually plotted alongside everything else in the final results of each stock.
              </p>
            </div>
          </div>
          <div class="folder">
            <h4>/plotting</h4>
            <p>Folder is home to functions dedicated to plotting the results of the batch tests.</p>
            <div class="file">
              <p><span class="path">plot_results.py</span>: The main file responsible for results plotting.</p>
            </div>
            <div class="file">
              <p><span class="path">api_chart.py</span>: This file is for a not-yet-implemented feature of pulling data from a direct-market-access provider and plotting the results with PyQT5.</p>
            </div>
            <div class="file">
              <p><span class="path">candles.py</span>: This file works in conjunction with <span class="path">api_chart.py</span> with this one specifically
                interfacing with PyQT5.
              </p>
            </div>
          </div>
          <div class="folder">
            <h4>/trade_funcs</h4>
            <p>
              This folder is all about sending orders and simulating executions in the backtester. The two are similar, but it is important to keep in
              mind what the algorithm can be aware of. While the program can know if a trade is about to fill in the next second, the algorithm can still not know that. So this is why there are two files here.
            </p>
            <div class="file">
              <p><span class="path">sim_executions.py</span>: This is the file that receives orders and keeps them until they either go through or get cancelled by the algorithm.
                It simulates market activity and fill probablility as well as being cusomizable through the <span class="path">main/config.json</span> file.
                For instance, if you wanted to ensure that each trade had to endure 2 seconds of lag minimum before a fill, this is where the lag and
                all other forms of market inefficiency are simulated.
              </p>
            </div>
            <div class="file">
              <p><span class="path">trade_funcs.py</span>: This file hosts functions that the algorithm uses to send and receive trades and update its position history (as well as position analysis).</p>
            </div>
          </div>
        </div>
        <div class="folder">
          <h3 id="mkt-csvs">/mkt_csvs</h3>
          <p>
            The csv data of market prices (OHLC) each minute that the market is open. It is important 
            to populate this folder because the batch testing uses this data to trade.
          </p>
        </div>
        <div class="folder">
          <h3 id="results-files">/results</h3>
          <p>
            This is where the results of the batch tests and batch comparisons are kept. They are categorized by date 
            and time and can be accessed with great detail through the <span class="path">batches.html</span> file. You can visit 
            the active link <a href="batches.html" target="_blank">here</a>.
          </p>
        </div>
        <div class="folder">
          <h3 id="temp-assets">/temp_assets</h3>
          <p>
            This folder is exclusively used for singular tests on one stock at a time (ei: without batch testing.) In previous versions, 
            each stock's results would be saved here in the batch test but the practice was deprecated to avoid issues with running multiple batch tests at once.
            The use of a singular non-batch test is still functional, but not suggested. See <a href="#batch-of-one">batch of one</a> instead.
          </p>
        </div>
      </section>
      <section id="up-and-run">
        <h1>Getting Up and Running</h1>
        <p>This section will teach</p>
        <h2 id="standard-batch">Standard Batch</h2>
        <p>Batch testing is the main functionality of the backtester. The <em>batch_test</em> function is highly customizeable and has
          many keywords arguments to take advantage of. 
          
          <br>
          <br>
          If you would like to simply run a full test of all of the csv files in the <span class="path">mkt_csvs</span> folder, simply go to the
          <span class="path">main.py</span> file and do this:
        </p>
        <pre><code class="language-python"># main.py
# batch.batch_test(**batch_params)
batch.standard_year_test()
# batch.compare_batches(**compare_params)
# batch.gl.save_worst_performers()
# batch.delete_results(min_stock_count=100)
</code></pre>
        <p>
          As you can see, there are several functions here that are used often and commented out. The 
          
          <func>standard_year_test</func> function is used to perform a normal batch test with no custom settings.
        </p>
        <h2 id="batch-params">Batch Customization</h2>
        <p>If, however, you would like to customize the batch test, then comment out all the lower functions except for 
          <func>batch_test</func> :
          
        </p>
        <pre><code class="language-python"># main.py
from local_functions.main import batch_testing as batch

batch_params = {
    'stop_at': 5,                           # Default = False
    # 'reps': 1,                            # Default = 1
    # 'mode': 'internal',                   # Default = 'multiple'
    # 'shuffle': False,                     # Default = True
    # 'create_compare': True,               # Default = False
    # 'config_setting': 'pick',             # Default = 'default'
    # 'first_run': False,                   # Default = True
    'inherit_csvs':  True,                  # Default = False
    'debug_plot':  True,                    # Default = False
}

batch.batch_test(**batch_params)
</code></pre>
        <p>
          When you use this function, the default kwargs are derived from the dictionary above. Here is a
          breakdown of the keywords and their meanings:
          
        </p>
        <ul class="batch-properties">
          <li><span class="prop">stop_at</span><span class="type">integer</span><span class="def">number of stocks (csv files) to test.</span></li>
          <li><span class="prop">reps</span><span class="type">integer</span><span class="def">
              number of times to test each stock OR to test entire set 
              (this depends of the <span class="prop">mode</span> setting).</span></li>
          <li><span class="prop">mode</span><span class="type">string</span><span class="def">
              'internal' or 'multiple'. 'internal' means that each stock will be tested
              <span class="prop">reps</span> amount of times. 'multiple' means that the entire batch of 
              stocks will be tested <span class="prop">reps</span> amount of times.</span></li>
          <li><span class="prop">shuffle</span><span class="type">boolean</span><span class="def">whether or not to randomize the order of stocks tested.</span></li>
          <li><span class="prop">create_compare</span><span class="type">boolean or string</span><span class="def">
              whether or not to create a batch compare file after the completion of 
              this batch. If not, enter False. If so, enter either 'date', 'time', or 'config'.
              When the batch is done there will be a batch comparison with the last batch created.
              For more info on batch compare see <a href="#batch-compare">batch compare</a>.</span></li>
          <li><span class="prop">config_setting</span><span class="type">string</span><span class="def">the name of the config file to use (located in <span class="path">config/saved_configurations</span>).
              You can also enter 'default' for the config file at <span class="path">local_functions/main/config.json</span>.
              Finally, you can alternatively enter 'pick' to have a terminal prompt with the available configurations.</span></li>
          <li><span class="prop">first_run</span><span class="type">boolean</span><span class="def">
              Because the function can be called recursively, it is helpful to know if it is the first run through the loop. 
              This is done so there are not multiple results files made for batches that take advantage of the recursive function.</span></li>
          <li><span class="prop">inherit_csvs</span><span class="type">boolean</span><span class="def">When a batch test is done, the names of the csvs used are saved in <span class="path">results/batch_csvs.json</span>.
              This can be useful if you wish to shuffle the stocks tested for variety, but would like to save the 
              shuffle and continue testing those particular stocks.</span></li>
          <li><span class="prop">debug_plot</span><span class="type">boolean</span><span class="def">
              When this is enabled, if an error occurs, a browser window will open showing the results of trading up until 
              the second the error occurred
              
              </span></li>
        </ul>
        <h2 id="batch-of-one">Batch of One</h2>
        <p>
          If you are trying to test just one stock, it is highly recommended to still batch. Batching has better traceback and debug
          capabilities and is already setup in the <span class="path">main.py</span> file. In order to do a '<em>batch of one</em>', all you need to do is specify
          <span class="prop">stop_at</span> to be 1. Like so:
        </p>
        <pre><code class="language-python"># main.py
from local_functions.main import batch_testing as batch

batch_params = {
    'stop_at': 1
    # Other Settings
}

batch.batch_test(**batch_params)
</code></pre>
        <p>
          If you would like to pick the specific file you wish to test, I would recommend keeping a folder inside the 
          <span class="path">mkt_csvs</span> folder in which to put all of the other files. This way you can control 
          which stock gets tested.
          
        </p>
        <h2 id="without-batch">Without Batching</h2>
        <p>
          If necessary, you can also circumvent batching altogether. This is not recommended for the reasons stated above,
          however, if you wish to do so, open up the <span class="path">test.py</span> file in the root directory and paste the following:
          
        </p>
        <pre><code class="language-python"># test.py
from local_functions.main import algo

CSV_NAME = 'path/to/stock.csv';

algo.test_trade(config='default', mode='csv',
        csv_file=CSV_NAME, batch_dir='temp_assets/')</code></pre>
        <p><em>note: make sure to put the path to your csv file in the variable string</em>.</p>
      </section>
    </div>
  </div>
  <script src="documentation_assets/index.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/prism.min.js" integrity="sha512-9+422Bs3A87UkWfp+qV80Nfv9arhbCXKY1rxrF2seorI36mIIstMiuBfyKLF1yH1nnzQkEWq2xrzT4XU3Z+vrA==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-python.min.js"></script>
</body>